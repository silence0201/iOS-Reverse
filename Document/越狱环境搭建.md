# 越狱环境搭建

## 设备要求

推荐`iPhone5S`以上设备,因为5S开始支持ARM64架构,当前设备已经普遍为ARM64架构,iPad至少为`iPad Air`或者`iPad mini2`等支持ARM64架构的设备,具体架构信息如下

| ARM芯片| iPhone机型 |
|------|-------|
| ARMv6 |  iPhone, iPhone2, iPhone3G, 第一代、第二代 iPod Touch |  
| ARMv7 | iPhone3GS｜iPhone4｜iPhone4S｜iPad｜iPad2｜iPad3(The New iPad)｜iPad mini｜iPod Touch 3G｜iPod Touch4 |   
| ARMv7s | iPhone5｜iPhone5C｜iPad4(iPad with Retina Display) |   
| ARM64 | iPhone5S｜ iPad Air｜ iPad mini2(iPad mini with Retina Display) |  
| ARM64e | iPhone XS |  

iOS系统,需要使用可以越狱的系统版本,一般iOS9.1是可以完美越狱的,推荐使用,那些版本可以越狱可是使用:[是否可以越狱](http://jailbreak.25pp.com/ios)

## iOS越狱

利用iOS系统的漏洞，获取iOS系统的最高权限（Root），解开之前的各种限制（合法行为）

### 越狱的优点

- 利用iOS越狱我们可以打造个性化、与众不同的iPhone
- 可以自由安装各种实用的插件、主题、APP
- 修改系统APP的一些默认行为，自由安装非AppSore来源的APP
- “付费APP”秒变“免费APP”
- 灵活管理文件系统，让iPhone可以像U盘一样使用
- 最有用的就是给开发者提供了逆向工程的环境

### 越狱的缺点

- 不予保修
- 费电，越狱后的iOS系统会常驻一些进程，耗电速度约提升10%~20%
- 在新的iOS固件版本出来的时候，不能及时地进行更新，每个新版本的固件，都会修复上一个版本的越狱漏洞，使越狱失效，如果需要保持越狱状态，要等待新的越狱程序发布时，才能升级相应的固件版本
- 不再受iOS系统默认的安全保护，容易被恶意软件攻击，个人隐私有被窃取的风险
- 如果安装了不稳定的插件，容易让系统变得不稳定、变慢，甚至出现“白苹果”等问题

### 越狱分类
1. 引导式越狱:  设备重启后之前的越狱状态就会失效.这时需要连接计算机,使用越狱软件引导开机,也就是重新越狱,否则设备就无法开机使用
2. 不完美越狱: 设备重启后,之前的越狱状态就会失效,不过设备可以作为非越狱设备正常使用.这时需要手动重新越狱.
3. 完美越狱: 越狱后重启设备,设备仍处于越狱状态,即重启不会破坏越狱环境

越狱方法: [PP助手](http://jailbreak.25pp.com/)

iOS11: [electra](https://github.com/coolstar/electra1131)  
iOS12: [unc0ver](https://github.com/pwn20wndstuff/Undecimus)  

## 判断设备是否越狱

1. 桌面上是否有Cydia或者使用PP助手等工具

![Cydia](https://raw.githubusercontent.com/silence0201/iOS-Reverse/master/Document/Asset/cydia.png)

![PP](https://raw.githubusercontent.com/silence0201/iOS-Reverse/master/Document/Asset/PP.png)

2. 使用代码判断,判断是否存在越狱相关文件

```objective-c
- (BOOL)isJailbroken {  
  BOOL jailbroken = NO;  
  NSString *cydiaPath = @"/Applications/Cydia.app";  
  NSString *aptPath = @"/private/var/lib/apt/";  
  if ([[NSFileManager defaultManager] fileExistsAtPath:cydiaPath]) {  
    jailbroken = YES;  
  }  
  if ([[NSFileManager defaultManager] fileExistsAtPath:aptPath]) {  
    jailbroken = YES;  
  }  
  return jailbroken;  
} 
```

## Cydia
它相当于越狱后的“App Store”，我们可以在Cydia中安装各种第三方的软件（插件、补丁、APP）作者：Jay Freeman (saurik)

![saurik](https://raw.githubusercontent.com/silence0201/iOS-Reverse/master/Document/Asset/saurik.png)

### 使用Cydia安装软件
1. 添加软件源（不同软件的软件源可能不同）,可以使用`雷锋源（apt.abcdia.com`
2. 进入软件源找到对应的软件，开始安装

*有时候通过Cydia安装完插件后，可能会出现重启SpringBoard，SpringBoard其实就是iOS的桌面*

### 必要软件和插件
1. Apple File Conduit 2 
作用: 可以访问整个iOS设备的文件系统    
类似的补丁还有：`afc2、afc2add`

2. AppSync Unified  
作用: 可以绕过系统验证，随意安装、运行破解的ipa安装包

3. iFile  
作用: 可以在iPhone上自由访问iOS文件系统
类似的还有`Filza File Manager、File Browser`

4. iFunBox  
作用: Mac端管理文件系统

5. OpenSSH  
作用: 远程登录  
默认已经安装,如果是iOS10以上的越狱设备需要安装`dropbear`替代

6. PP助手  
作用: IPA下载和安装工具

### 安装包

通常情况:  
- 通过Cydia安装的安装包是deb格式的（结合软件包管理工具apt）
- 通过PP助手安装的安装包是ipa格式的

如果不是通过Cydia源:
- 将deb安装包放到`/var/root/Media/Cydia/AutoInstall`,重启手机，Cydia就会自动安装deb
- 使用`dpkg`命令安装
```base
dpkg -i ifile.deb
```